<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resuscitation App - Midterm Fix</title>
    <style>
        /* =========================================
           THE PARAMETRIC ENGINE (CSS Variables)
           ========================================= */
        :root {
            /* --- GEOMETRY & PHYSICS --- */
            --app-width: 390px;
            --app-height: 844px;
            --rail-inset: 16px;
            --wheel-diameter: 340px; /* Maximize width */
            --card-ratio: 0.75; /* Width relative to wheel */
            
            /* --- STACKING PHYSICS --- */
            --preview-scale-step: 0.08;
            --preview-y-step: 12px;
            --history-y-step: 15px;

            /* --- LINE ART AESTHETIC --- */
            --stroke-width: 2px;
            --radius-lg: 24px;
            --radius-md: 12px;
            --radius-sm: 6px;

            /* --- GLOBAL FILTER ENGINE (The "Instagram" Logic) --- */
            --base-hue: 0;
            --saturation: 0%;
            --lightness: 98%;
            --ink-color: #111;
            --accent-color: #d32f2f; /* Medical Red */
            --global-contrast: 100%;
            --global-sepia: 0%;
            
            /* --- LAYOUT RHYTHM --- */
            --header-height: 60px;
            --footer-height: 120px;
            /* Top/Bottom/Middle zones are calculated via Flexbox */
        }

        /* Global Reset & Typography */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: #222; /* Lab Bench Background */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Global Filter Application */
            filter: contrast(var(--global-contrast)) sepia(var(--global-sepia));
        }

        /* =========================================
           THE DEVICE FRAME
           ========================================= */
        #device-frame {
            width: var(--app-width);
            height: var(--app-height);
            background-color: hsl(var(--base-hue), var(--saturation), var(--lightness));
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 4px solid #333;
            border-radius: 40px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* =========================================
           ZONE 1: HEADER
           ========================================= */
        header {
            height: var(--header-height);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: var(--stroke-width) solid var(--ink-color);
            z-index: 500;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
        }
        .app-title { font-weight: 800; font-size: 16px; letter-spacing: -0.5px; }
        .header-icon { width: 24px; height: 24px; cursor: pointer; }

        /* =========================================
           ZONE 2: TOP PREVIEW (The Future)
           ========================================= */
        #zone-top {
            flex: 1; /* Dynamic Height */
            position: relative;
            perspective: 1000px;
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Anchor to bottom of zone */
            padding-bottom: 20px;
        }

        /* =========================================
           ZONE 3: MIDDLE STAGE (The Present)
           ========================================= */
        #zone-middle {
            height: var(--wheel-diameter);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        /* The Rail */
        #rail {
            width: var(--wheel-diameter);
            height: var(--wheel-diameter);
            border: 1px solid rgba(0,0,0,0.15); /* Subtle guide rail */
            border-radius: 50%;
            position: absolute;
        }

        /* The Actuator Node (Knob) */
        #actuator-node {
            width: 32px;
            height: 32px;
            background: var(--ink-color);
            border-radius: 50%;
            position: absolute;
            z-index: 200; /* Above rail, below modal */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            /* Position set via JS */
        }
        
        /* Interaction Halo for Knob */
        #actuator-node::after {
            content: ''; position: absolute;
            top: -15px; left: -15px; right: -15px; bottom: -15px;
        }

        /* The Middle Card Container */
        #middle-card-slot {
            width: calc(var(--wheel-diameter) * var(--card-ratio));
            height: calc(var(--wheel-diameter) * 0.85); /* 4:3ish ratio */
            position: relative;
            z-index: 150;
        }

        /* =========================================
           ZONE 4: BOTTOM HISTORY (The Past)
           ========================================= */
        #zone-bottom {
            flex: 0.8; 
            position: relative;
            z-index: 40;
            display: flex;
            justify-content: center;
            padding-top: 20px;
        }

        /* =========================================
           ZONE 5: FOOTER (Checklist)
           ========================================= */
        footer {
            height: var(--footer-height);
            border-top: var(--stroke-width) solid var(--ink-color);
            background: #fff;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            z-index: 500;
        }

        .footer-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
            border: 1px solid #ccc;
            padding: 2px 6px;
            border-radius: 4px;
        }

        #checklist-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .check-item {
            display: flex;
            align-items: center;
            font-size: 13px;
            gap: 10px;
        }
        .check-item input { width: 16px; height: 16px; accent-color: var(--ink-color); }

        /* =========================================
           CARD COMPONENT STYLES
           ========================================= */
        .card {
            background: white;
            border: var(--stroke-width) solid var(--ink-color);
            border-radius: var(--radius-md);
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center bottom;
        }

        /* Preview Stack Styling */
        .preview-card {
            width: 140px; height: 180px; /* Smaller */
            background: #f0f0f0;
            color: #666;
        }

        /* Decision Icon on Preview (The Hint) */
        .preview-decision-icon {
            position: absolute;
            top: -10px; right: -10px;
            width: 30px; height: 30px;
            background: white;
            border: 2px solid var(--ink-color);
            border-radius: 50%;
            padding: 4px;
            z-index: 10;
        }

        /* Active Card Styling */
        .active-card-content {
            text-align: center;
            display: flex;
            flex-direction: column;
            height: 100%;
            justify-content: center;
            align-items: center;
        }
        .card-title { font-size: 18px; font-weight: 800; margin-bottom: 10px; }
        .card-body { font-size: 14px; line-height: 1.4; color: #444; }

        /* Middle Card Tools */
        .tool-icon {
            position: absolute;
            width: 24px; height: 24px;
            opacity: 0.6;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .tool-icon:hover { opacity: 1; }
        .tool-tl { top: 10px; left: 10px; } /* Empty usually */
        .tool-tr { top: 10px; right: 10px; } /* Fullscreen */
        .tool-bl { bottom: 10px; left: 10px; } /* Toolbox */
        .tool-br { bottom: 10px; right: 10px; } /* Carousel Dots */

        /* Cover Card Special */
        .card.cover {
            border: none;
            background: transparent;
            box-shadow: none;
        }

        /* =========================================
           DECISION CAROUSEL (The Miracle)
           ========================================= */
        /* Logic: When parent has class 'decision-mode', flex direction changes */
        #zone-top.decision-mode {
            flex-direction: row;
            align-items: center;
            gap: 20px;
        }
        
        .carousel-card {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .carousel-card.center {
            transform: scale(1.1);
            opacity: 1;
            z-index: 100;
            border-color: var(--accent-red);
        }
        
        .carousel-card.flank {
            transform: scale(0.8);
            opacity: 0.5;
            z-index: 50;
        }

        /* =========================================
           MODAL
           ========================================= */
        #toolbox-modal {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-body {
            background: white; width: 80%; padding: 20px;
            border-radius: var(--radius-lg);
            text-align: center;
        }

    </style>
</head>
<body>

    <div id="device-frame">
        <!-- HEADER -->
        <header>
            <div class="app-title">Resuscitation Handbook</div>
            <div style="display:flex; gap:10px;">
                <!-- SEARCH ICON -->
                <svg class="header-icon" viewBox="0 0 24 24">
                    <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <!-- 3 DOTS -->
                <svg class="header-icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="5" r="2" fill="currentColor"/>
                    <circle cx="12" cy="12" r="2" fill="currentColor"/>
                    <circle cx="12" cy="19" r="2" fill="currentColor"/>
                </svg>
            </div>
        </header>

        <!-- ZONE TOP (Preview) -->
        <div id="zone-top">
            <!-- Cards injected via JS -->
        </div>

        <!-- ZONE MIDDLE (Stage) -->
        <div id="zone-middle">
            <div id="rail"></div>
            
            <!-- THE MIDDLE CARD -->
            <div id="middle-card-slot">
                <!-- Active Card injected via JS -->
            </div>

            <!-- THE ACTUATOR (Wheel Knob) -->
            <div id="actuator-node"></div>
        </div>

        <!-- ZONE BOTTOM (History) -->
        <div id="zone-bottom">
            <!-- Cards injected via JS -->
        </div>

        <!-- FOOTER -->
        <footer>
            <div class="footer-meta">
                <span style="font-weight:bold; font-size:12px; color:#666;">CHECK LIST</span>
                <div class="timer-display" id="global-timer">00:00:00</div>
            </div>
            <div id="checklist-container">
                <!-- Checkbox items injected via JS -->
            </div>
        </footer>

        <!-- TOOLBOX MODAL -->
        <div id="toolbox-modal" onclick="closeModal()">
            <div class="modal-body" onclick="event.stopPropagation()">
                <h3>Toolbox</h3>
                <p>Age Calculator / Drug Dosing</p>
                <button onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- INLINE ICONS (Defined once, used via HTML generation) -->
    <svg style="display:none;">
        <!-- decision-tree-upper -->
        <symbol id="icon-branch" viewBox="0 0 24 24">
            <path d="M12 3V12M12 12L6 18M12 12L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <!-- first-aid-kit -->
        <symbol id="icon-toolbox" viewBox="0 0 24 24">
            <path d="M4 8H20V20H4V8Z" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M8 8V4H16V8" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M12 11V17M9 14H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- fullscreen -->
        <symbol id="icon-fullscreen" viewBox="0 0 24 24">
            <path d="M4 4H10M4 4V10M20 4H14M20 4V10M4 20H10M4 20V14M20 20H14M20 20V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
    </svg>

<script>
/* =========================================
   THE DATA MODEL (JSON GRAPH)
   ========================================= */
const ALGORITHM_DB = {
    "CARD_00": {
        id: "CARD_00", type: "cover",
        title: "Paediatric Basic Life Support",
        body: "Out-of-Hospital Algorithm",
        next: "CARD_01",
        knobStart: 330 // 11 o'clock
    },
    "CARD_01": {
        id: "CARD_01", type: "standard",
        title: "Unresponsive?",
        body: "Check for safety. Check responsiveness.",
        checklist: [
            {id: "safe", label: "Area Safe"},
            {id: "unresp", label: "Confirm Unresponsive"}
        ],
        next: "CARD_02",
        knobStart: 0 // 12 o'clock
    },
    "CARD_02": {
        id: "CARD_02", type: "standard",
        title: "Shout for Help",
        body: "Shout loudly. If alone, do not leave child yet.",
        checklist: [
            {id: "2nd", label: "2nd Rescuer Present?", type: "toggle"},
            {id: "999", label: "Call 999", visibleIf: "2nd"}
        ],
        next: "CARD_03",
        knobStart: 300 // 10 o'clock (Visual distinction)
    },
    "CARD_03": {
        id: "CARD_03", type: "standard",
        title: "Airway",
        body: "Open Airway using Head Tilt / Chin Lift.",
        checklist: [{id: "airway", label: "Airway Open"}],
        next: "CARD_04", // The Decision is next
        knobStart: 280
    },
    "CARD_04": {
        id: "CARD_04", type: "decision",
        title: "Breathing?",
        body: "Is the child breathing normally?",
        options: [
            {label: "NO", next: "CARD_05"},
            {label: "YES", next: "CARD_END_OBS"}
        ],
        knobStart: 270 // 9 o'clock - LOCKED
    },
    "CARD_05": {
        id: "CARD_05", type: "standard",
        title: "5 Rescue Breaths",
        body: "Give 5 initial rescue breaths.",
        next: "CARD_06",
        knobStart: 270
    },
    "CARD_END_OBS": {
        id: "CARD_END_OBS", type: "terminal",
        title: "Observation",
        body: "Place in recovery position. Monitor.",
        knobStart: 60
    }
};

/* =========================================
   STATE MANAGEMENT
   ========================================= */
let state = {
    currentId: "CARD_00",
    history: [], // Stack of Card IDs
    previewQueue: ["CARD_01", "CARD_02", "CARD_03"], // Pre-calculated for demo
    wheelAngle: 330,
    timerRunning: false,
    timerSeconds: 0,
    decisionIndex: 0 // 0=NO, 1=YES (For Carousel)
};

/* =========================================
   THE PHYSICS ENGINE
   ========================================= */
const KNOB = document.getElementById('actuator-node');
const RAIL = document.getElementById('rail');
const RAIL_CENTER = { x: 0, y: 0 }; // Calculated on load
const RADIUS = 170; // Half of 340px

// Update center on resize
function updateMetrics() {
    const rect = RAIL.getBoundingClientRect();
    RAIL_CENTER.x = rect.left + rect.width/2;
    RAIL_CENTER.y = rect.top + rect.height/2;
}
window.addEventListener('resize', updateMetrics);
setTimeout(updateMetrics, 100);

// Knob Drag Logic
let isDragging = false;
let startAngle = 0;
let accumDelta = 0;

KNOB.addEventListener('mousedown', startDrag);
KNOB.addEventListener('touchstart', startDrag, {passive: false});

function startDrag(e) {
    e.preventDefault();
    isDragging = true;
    accumDelta = 0;
    const pt = getPoint(e);
    startAngle = getAngle(pt.x, pt.y);
    
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('touchmove', onDrag, {passive: false});
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);
}

function getPoint(e) {
    return e.touches ? {x: e.touches[0].clientX, y: e.touches[0].clientY} : {x: e.clientX, y: e.clientY};
}

// Convert XY to 0-360 degrees (0 at top, CW positive)
function getAngle(x, y) {
    const dx = x - RAIL_CENTER.x;
    const dy = y - RAIL_CENTER.y;
    // atan2 gives radians from X axis. We rotate -90 to make 0 at top
    let theta = Math.atan2(dy, dx) * (180/Math.PI); 
    let cssDeg = theta + 90;
    if (cssDeg < 0) cssDeg += 360;
    return cssDeg;
}

function onDrag(e) {
    if (!isDragging) return;
    const pt = getPoint(e);
    const currentAngle = getAngle(pt.x, pt.y);
    
    // Calculate Delta (Anticlockwise is NEGATIVE in degrees, but we want positive logic for pull)
    // Wait. 330 -> 270 is -60. So Decreasing Angle = Advance.
    let delta = startAngle - currentAngle; 
    
    // Handle wrap around (0 <-> 360)
    if (delta > 180) delta -= 360;
    if (delta < -180) delta += 360;

    // Visual Update of Knob
    let newVisualAngle = state.wheelAngle - delta; // Move with finger
    updateKnobPosition(newVisualAngle);
    
    accumDelta += delta;
    startAngle = currentAngle; // Reset for next frame

    const currentCard = ALGORITHM_DB[state.currentId];

    // --- LOGIC GATE 1: STANDARD ADVANCE ---
    if (currentCard.type !== 'decision') {
        // Threshold: 25 degrees Anticlockwise (positive delta)
        if (accumDelta > 25) {
            triggerAdvance();
            endDrag(); // Snap interaction
        }
    } 
    // --- LOGIC GATE 2: DECISION CAROUSEL (The Miracle) ---
    else {
        // Vertical Wheel Movement maps to Horizontal Index
        // 20 degrees delta = 1 index switch
        if (Math.abs(accumDelta) > 30) {
            // Toggle Decision
            state.decisionIndex = state.decisionIndex === 0 ? 1 : 0;
            renderPreviewZone(); // Re-render top carousel
            accumDelta = 0; // Reset
            // Haptic
            if(navigator.vibrate) navigator.vibrate(10);
        }
    }
}

function endDrag() {
    isDragging = false;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('touchmove', onDrag);
    // Snap Back to Ideal Position
    const card = ALGORITHM_DB[state.currentId];
    state.wheelAngle = card.knobStart; 
    updateKnobPosition(state.wheelAngle);
}

function updateKnobPosition(deg) {
    // Math: Convert CSS deg back to Radians for XY
    // 0 deg = -90 math deg
    const rad = (deg - 90) * (Math.PI / 180);
    const x = RADIUS * Math.cos(rad);
    const y = RADIUS * Math.sin(rad);
    
    // Center is 170,170 relative to zone-middle (340x340)
    KNOB.style.transform = `translate(${170 + x - 16}px, ${170 + y - 16}px)`;
}

/* =========================================
   CORE LOGIC & RENDERING
   ========================================= */

function triggerAdvance() {
    const curr = ALGORITHM_DB[state.currentId];
    if (!curr.next) return;

    // 1. Move Current to History
    state.history.push(state.currentId);
    
    // 2. Set New Current
    state.currentId = curr.next;
    state.wheelAngle = ALGORITHM_DB[state.currentId].knobStart; // Update target angle

    // 3. Update Previews
    // Simple lookahead logic for demo
    const nextCard = ALGORITHM_DB[state.currentId];
    if(nextCard.next) {
        state.previewQueue = [nextCard.next]; 
        if(ALGORITHM_DB[nextCard.next].next) state.previewQueue.unshift(ALGORITHM_DB[nextCard.next].next);
        if(state.previewQueue.length > 3) state.previewQueue.pop();
    } else if (nextCard.type === 'decision') {
        state.previewQueue = []; // Clear stack for decision mode
    }

    // 4. Start Timer if not running
    if (!state.timerRunning && state.currentId !== 'CARD_00') {
        startTimer();
    }

    renderAll();
}

function confirmDecision() {
    // Called when Swiping Down on a Decision
    const curr = ALGORITHM_DB[state.currentId];
    const choice = curr.options[state.decisionIndex]; // 0 or 1
    
    state.history.push(state.currentId);
    state.currentId = choice.next;
    state.wheelAngle = ALGORITHM_DB[state.currentId].knobStart;
    state.decisionIndex = 0; // Reset
    
    renderAll();
}

/* --- RENDER FUNCTIONS --- */

function renderAll() {
    renderMiddle();
    renderTop();
    renderBottom();
    renderChecklist();
    updateKnobPosition(state.wheelAngle);
}

function renderMiddle() {
    const card = ALGORITHM_DB[state.currentId];
    const slot = document.getElementById('middle-card-slot');
    
    // Class handling
    let classes = 'card';
    if (card.type === 'cover') classes += ' cover';

    // Icons HTML
    let tools = '';
    if (card.type !== 'cover') {
        tools = `
            <div class="tool-icon tool-tr"><svg viewBox="0 0 24 24" style="width:100%;height:100%;"><use href="#icon-fullscreen"></use></svg></div>
            <div class="tool-icon tool-bl" onclick="openModal()"><svg viewBox="0 0 24 24" style="width:100%;height:100%;"><use href="#icon-toolbox"></use></svg></div>
        `;
    }

    slot.innerHTML = `
        <div class="${classes}">
            ${tools}
            <div class="active-card-content">
                <div class="card-title">${card.title}</div>
                <div class="card-body">${card.body}</div>
            </div>
        </div>
    `;
}

function renderTop() {
    const zone = document.getElementById('zone-top');
    const curr = ALGORITHM_DB[state.currentId];
    zone.innerHTML = '';

    // --- DECISION MODE (Horizontal Carousel) ---
    if (curr.type === 'decision') {
        zone.classList.add('decision-mode');
        
        // Render Options based on state.decisionIndex
        curr.options.forEach((opt, idx) => {
            const isCenter = idx === state.decisionIndex;
            const el = document.createElement('div');
            el.className = `card preview-card carousel-card ${isCenter ? 'center' : 'flank'}`;
            el.innerHTML = `
                <div class="active-card-content">
                    <div style="font-weight:bold; font-size:24px;">${opt.label}</div>
                    <div style="font-size:10px;">Swipe Down to Confirm</div>
                </div>
            `;
            
            // Add Swipe Listener
            if (isCenter) {
                let startY = 0;
                el.addEventListener('touchstart', e => startY = e.touches[0].clientY);
                el.addEventListener('touchend', e => {
                    if (e.changedTouches[0].clientY - startY > 50) confirmDecision();
                });
            }
            zone.appendChild(el);
        });

    } 
    // --- STANDARD MODE (Vertical Stack) ---
    else {
        zone.classList.remove('decision-mode');
        state.previewQueue.forEach((pid, index) => {
            const pCard = ALGORITHM_DB[pid];
            if(!pCard) return;
            
            const el = document.createElement('div');
            el.className = 'card preview-card';
            
            // Z-Depth Logic
            // Index 0 is BACK of queue. Index Length-1 is FRONT.
            // Wait, usually array[0] is next up.
            // Let's assume array[0] is "Next Card".
            // Stack: Next Card (Front), Next+1 (Behind).
            
            // CSS Transform based on index (Reverse order for visual stack)
            const stackIndex = index; 
            el.style.transform = `translateY(${stackIndex * -12}px) scale(${1 - stackIndex * 0.08})`;
            el.style.zIndex = 50 - index;
            el.style.opacity = 1 - (index * 0.3);

            // Decision Icon Logic
            let iconHTML = '';
            if (pCard.type === 'decision') {
                iconHTML = `<div class="preview-decision-icon"><svg viewBox="0 0 24 24" style="width:100%;height:100%"><use href="#icon-branch"></use></svg></div>`;
            }

            el.innerHTML = `
                ${iconHTML}
                <div class="active-card-content">
                    <div style="font-weight:bold; font-size:12px;">COMING UP</div>
                    <div class="card-title" style="font-size:14px;">${pCard.title}</div>
                </div>
            `;
            zone.appendChild(el);
        });
    }
}

function renderBottom() {
    const zone = document.getElementById('zone-bottom');
    zone.innerHTML = '';
    
    // Show last history item
    if (state.history.length > 0) {
        const lastId = state.history[state.history.length - 1];
        const card = ALGORITHM_DB[lastId];
        
        const el = document.createElement('div');
        el.className = 'card preview-card';
        el.style.opacity = '0.4';
        el.style.transform = 'scale(0.9) translateY(10px)';
        el.innerHTML = `<div class="active-card-content"><div class="card-title" style="font-size:12px;">${card.title}</div></div>`;
        zone.appendChild(el);
    }
}

function renderChecklist() {
    const container = document.getElementById('checklist-container');
    const card = ALGORITHM_DB[state.currentId];
    container.innerHTML = '';
    
    if (card.checklist) {
        card.checklist.forEach(item => {
            const el = document.createElement('label');
            el.className = 'check-item';
            el.innerHTML = `<input type="checkbox"> ${item.label}`;
            container.appendChild(el);
        });
    } else {
        container.innerHTML = '<span style="color:#999; font-size:12px; font-style:italic;">No tasks</span>';
    }
}

/* =========================================
   UTILITIES (Timer, Modals)
   ========================================= */
function startTimer() {
    state.timerRunning = true;
    setInterval(() => {
        state.timerSeconds++;
        const date = new Date(0);
        date.setSeconds(state.timerSeconds);
        document.getElementById('global-timer').innerText = date.toISOString().substr(11, 8);
    }, 1000);
}

function openModal() { document.getElementById('toolbox-modal').style.display = 'flex'; }
function closeModal() { document.getElementById('toolbox-modal').style.display = 'none'; }

// Initialize
renderAll();

</script>
</body>
</html>